<template>
    <menu-item :item="item" />
</template>

<script>
    import MenuItem from './menu-item'
    import LC from '@/element-materials/core'
    
    export default {
        components: {
            MenuItem
        },
        data () {
            return {
                item: {
                    icon: 'bk-drag-icon bk-drag-templateline',
                    text: window.i18n.t('存为模板'),
                    tips: window.i18n.t('将画布内容区域（不包含导航部分）存为模板'),
                    func: this.toggleShowTemplateDialog
                }
            }
        },
        methods: {
            toggleShowTemplateDialog () {
                const activeNode = LC.getRoot()
                
                const excludeInteractiveChildrenJSON = activeNode.children.reduce((result, node) => {
                    if (!node.isInteractiveComponent) {
                        result.push(node.toJSON())
                    }
                    return result
                }, [])
                if (excludeInteractiveChildrenJSON.length < 1) {
                    this.messageError(window.i18n.t('页面模板不能为空'))
                    return
                }
                // 需要新建一个gird包裹整个页面
                const girdNodeJSON = LC.createNode('render-grid').toJSON()
                const columnNodeJSON = LC.createNode('render-column').setStyle('width', '100%').toJSON()
                columnNodeJSON.renderSlots.default = excludeInteractiveChildrenJSON
                girdNodeJSON.renderSlots.default = [columnNodeJSON]
                LC.triggerEventListener('saveTemplate', {
                    target: activeNode,
                    type: 'saveTemplate',
                    value: girdNodeJSON
                })
            }
        }
        
    }
</script>
